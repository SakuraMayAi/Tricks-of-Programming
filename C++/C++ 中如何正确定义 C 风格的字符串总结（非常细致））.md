# C++ 中定义 C 风格字符串的方式

读者首先看看如下代码，看看你能否说出这些定义方式的区别在哪。
```cpp
char str[5] = NULL;
char str[5] = { "NULL" };
char str[5] = "NULL";

char str = NULL;
char str = { "NULL" };
char str = "NULL";

char* str = NULL;
char* str = "NULL";
char* str = { "NULL" };
```

接下来依次讲讲这些定义方式都有什么区别。


## 第一部分

```cpp
char str[5] = NULL;         // 错误
char str[5] = { "NULL" };   // 正确。定义了一个字符数组
char str[5] = "NULL";       // 正确。定义了一个字符数组
```

第一种方式是错误的，因为 `NULL` 是一个宏，定义为 `(void *)0`，表示**空指针**。而**字符数组**期待的是一个**字符**或**字符列表**，所以不能将它初始化为 `NULL`。

后两种定义方式都是正确的，但是存在些许的区别：

- 第二种：`NULL` 是一个**字符串常量**，在编译时会被视为一个存储在**只读内存**中的 `const char[5]` 类型的**常量字符数组** `{'N', 'U', 'L', 'L', '\0'}`。数组名 `str` 是一个**指针**，指向数组的**第一个元素（字符）**，但它实际上是一个分配了**固定内存空间的对象**。

* 第三种：这种方式更常见也更直观。它实际上是将**字符串字面值 `NULL`** 的字符和结尾的空字符 `'\0'` 拷贝到数组 `str` 中。

两者的区别在于，前者采用的是**初始化列表**的方式，后者采用的是**拷贝（底层）**。但无论使用哪种方式，都是定义了一个字符数组 `str`，都可以修改其中的字符，比如 `str[0] = 'H'`。

## 第二部分

```cpp
char str = NULL;        // 错误
char str = { "NULL" };  // 错误
char str = "NULL";      // 错误
```

第一种方式是错误的，因为 `NULL` 是一个宏，定义为 `(void *)0`，表示**空指针**。不能用 `NULL` 初始化一个 `char` 类型变量。

第二种、第三种方式都是错误的，因为 `NULL` 是一个**字符串常量**，在编译时会被视为一个存储在**只读内存**中的 `const char[5]` 类型的**常量字符数组** `{'N', 'U', 'L', 'L', '\0'}`。而 `const char[5]` 类型可以被**隐式地**转换为 `const char*` 类型，因为 C 语言允许**数组类型**在需要的时候隐式转换为**指向数组首元素的指针**。

然而，`char` 是一个单字符类型，不能使用一个字符串常量来初始化。所以后两种方式都是错的。

## 第三部分

```cpp
char* str = NULL;       // 正确。定义了一个初始值为 NULL ，指向 char 类型的指针
char* str = "NULL";     // 警告：字符串常量转 char* 是不允许的，存在安全隐患
char* str = {"NULL"};   // 警告：字符串常量转 char* 是不允许的，存在安全隐患
```

第一种方式是正确的，由前面对 `NULL` 的介绍可以知道这种初始化是合法的。

第二种、第三种方式都在尝试**初始化**一个**指向 `char` 类型的指针**，在这种情况下，加不加括号 `{}` 是没有区别的。执行后两条语句时，字符串常量 `NULL` 被隐式地转换为**指向它首字符的指针**（`const char*` 类型的指针）。当我们将它赋值给 `str` 时，编译器就会发出警告，因为字符串常量不能被安全地转换为 `char*`。在某些编译器中，这种初始化方式是不会报错的，可如果尝试通过 `str` 修改字符串常量的内容，就会引发运行时错误。要想正确执行这个初始化，需要加上 `const` 关键字。

```cpp
const char* str = "NULL";       // 正确且安全
const char* str = { "NULL" };   // 正确且安全
```

再者，由于**初始化列表**通常用于**初始化数组**，所以第三种方式实际上并不是一个有效的初始化方式。而且初始化列表的方式**不应该用于初始化单个字符指针**，而是用于初始化**字符指针数组**（又或者说是字符串数组，即数组中的每个元素都是一个字符串）。如下所示定义了一个字符指针数组，`str` 的类型是 `const char*[]`，与此同时，`str` 数组是一个包含三个 `char*` 元素的数组，每个元素都指向一个字符串常量。

```cpp
const char* str[3] = { "NULL", "HELLO", "WORLD" };  // 正确且安全
```
